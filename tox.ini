[tox]
envlist = py{36,37}-{offline,astropydev,numpydev,sunpydev},build_docs,conda,pycodestyle

[testenv]
changedir = tmp
setenv =
    MPLBACKEND = agg
    COLUMNS = 180
    PYTEST_COMMAND = pytest --pyargs ndcube --cov=ndcube --cov-config={toxinidir}/setup.cfg --verbose --durations=25
extras = dev
deps =
    sunpydev: git+https://github.com/sunpy/sunpy
    astropydev,numpydev: cython
    numpydev: git+https://github.com/numpy/numpy
    astropydev: git+https://github.com/astropy/astropy
commands =
    offline,astropydev,numpydev,sunpydev: {env:PYTEST_COMMAND} {posargs}

[testenv:pycodestyle]
changedir = {toxinidir}
basepython = python3.7
deps =
    pycodestyle
commands = pycodestyle ndcube --count

[testenv:build_docs]
basepython = python3.7
changedir = {toxinidir}
extras = dev
commands = sphinx-build docs docs/_build/html -W -b html

# This env requires tox-conda.
[testenv:conda]
basepython = python3.6
extras =
deps =
conda_deps =
    sunpy
    pytest-astropy
    pytest-cov
conda_channels = sunpy
commands = {env:PYTEST_COMMAND} {posargs}
